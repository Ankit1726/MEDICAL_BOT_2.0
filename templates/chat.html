<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Medical Chatbot</title>

  <!-- Bootstrap 5 -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <!-- Font Awesome -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
  />

  <!-- Custom CSS -->
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
</head>
<body class="d-flex align-items-center justify-content-center vh-100">

  <div class="container-fluid">
    <div class="row justify-content-center">
      <div class="col-lg-6 col-md-8 col-sm-12">
        <div class="card shadow-lg chat">
          <!-- Header -->
          <div class="card-header d-flex align-items-center">
            <div class="d-flex align-items-center">
              <div class="position-relative me-3">
                <img
                  src="https://cdn-icons-png.flaticon.com/512/387/387569.png"
                  class="rounded-circle"
                  alt="Bot Avatar"
                  width="50"
                  height="50"
                />
                <span
                  class="position-absolute bottom-0 end-0 translate-middle p-1 bg-success border border-light rounded-circle"
                ></span>
              </div>
              <div>
                <h6 class="mb-0 text-white">Medical Chatbot</h6>
                <small class="text-white-50">Ask me anything!</small>
              </div>
            </div>
          </div>

          <!-- Messages -->
          <div id="messageContainer" class="card-body msg_card_body"></div>

          <!-- Footer -->
          <div class="card-footer">
            <form id="messageForm" class="d-flex">
              <input
                type="text"
                id="text"
                name="msg"
                placeholder="Type your message..."
                autocomplete="off"
                class="form-control me-2 type_msg"
                required
              />
              <button type="submit" class="btn send_btn">
                <i class="fas fa-paper-plane"></i>
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap 5 JS (no jQuery needed) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const messageForm = document.getElementById("messageForm");
      const messageContainer = document.getElementById("messageContainer");
      const textInput = document.getElementById("text");

      messageForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        const rawText = textInput.value.trim();
        if (!rawText) return;

        const date = new Date();
        const str_time = `${date.getHours()}:${date.getMinutes()}`;

        // User message
        const userHtml = `
          <div class="d-flex justify-content-end mb-3">
            <div class="msg_cotainer_send">
              ${rawText}
              <span class="msg_time_send">${str_time}</span>
            </div>
            <div class="ms-2">
              <img src="https://i.ibb.co/d5b84Xw/Untitled-design.png"
                class="rounded-circle user_img_msg"
                alt="User Avatar" width="40" height="40"/>
            </div>
          </div>`;
        messageContainer.insertAdjacentHTML("beforeend", userHtml);
        textInput.value = "";

        // Send to backend
        try {
          const response = await fetch("/get", {
            method: "POST",
            headers: { "Content-Type": "application/x-www-form-urlencoded" },
            body: new URLSearchParams({ msg: rawText }),
          });

          const data = await response.text();

          const botHtml = `
            <div class="d-flex justify-content-start mb-3">
              <div class="me-2">
                <img src="https://cdn-icons-png.flaticon.com/512/387/387569.png"
                  class="rounded-circle user_img_msg"
                  alt="Bot Avatar" width="40" height="40"/>
              </div>
              <div class="msg_cotainer">
                ${data}
                <span class="msg_time">${str_time}</span>
              </div>
            </div>`;
          messageContainer.insertAdjacentHTML("beforeend", botHtml);
          messageContainer.scrollTop = messageContainer.scrollHeight;
        } catch (error) {
          console.error("Error:", error);
        }
      });
    });
  </script>
</body>
</html>
